!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.urlParser=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=function(e){if("object"!==t(e))return"";e.params=e.params||{};var r="",i=0,a=Object.keys(e.params);if(0===a.length)return"";for(a.sort(),e.hasParams||(r+="?"+a[0]+"="+e.params[a[0]],i+=1);i<a.length;i+=1)r+="&"+a[i]+"="+e.params[a[i]];return r},r=function(t){return void 0===t?0:t.match(/^(\d+[smhdw]?)+$/)?function(t){var e,r=0,i={s:1,m:60,h:3600,d:86400,w:604800};e=(t=t.replace(/([smhdw])/g," $1 ").trim()).split(" ");for(var a=0;a<e.length;a+=2)r+=parseInt(e[a],10)*i[e[a+1]||"s"];return r}(t):t.match(/^(\d+:?)+$/)?function(t){for(var e=0,r=[1,60,3600,86400,604800],i=t.split(":"),a=0;a<i.length;a++)e+=parseInt(i[a],10)*r[i.length-a-1];return e}(t):0},i=function(t){if("string"!=typeof t)return{};var e,r={},i=(t=t.split("+").join(" ")).match(/(?:[?](?:[^=]+)=(?:[^&#]*)(?:[&](?:[^=]+)=(?:[^&#]*))*(?:[#].*)?)|(?:[#].*)/);if(null===i)return{};e=i[0].substr(1).split(/[&#=]/);for(var a=0;a<e.length;a+=2)r[decodeURIComponent(e[a])]=decodeURIComponent(e[a+1]||"");return r};function a(){for(var t=["parseProvider","parse","bind","create"],e=0;e<t.length;e++){var r=t[e];this[r]=this[r].bind(this)}this.plugins={}}var s=a;a.prototype.parseProvider=function(t){var e=t.match(/(?:(?:https?:)?\/\/)?(?:[^.]+\.)?(\w+)\./i);return e?e[1]:void 0},a.prototype.parse=function(t){if(void 0!==t){var e,r=this.parseProvider(t),a=this.plugins[r];if(r&&a&&a.parse)return(e=a.parse.call(a,t,i(t)))&&((e=function(t){t.params&&0===Object.keys(t.params).length&&delete t.params;return t}(e)).provider=a.provider),e}},a.prototype.bind=function(t){if(this.plugins[t.provider]=t,t.alternatives)for(var e=0;e<t.alternatives.length;e+=1)this.plugins[t.alternatives[e]]=t},a.prototype.create=function(t){var e=t.videoInfo,r=t.params,i=this.plugins[e.provider];if(r="internal"===r?e.params:r||{},i&&(t.format=t.format||i.defaultFormat,i.formats.hasOwnProperty(t.format)))return i.formats[t.format].apply(i,[e,Object.assign({},r)])};var o=new s,n=e,p=r;function l(){this.provider="youtube",this.alternatives=["youtu","ytimg"],this.defaultFormat="long",this.formats={short:this.createShortUrl,long:this.createLongUrl,embed:this.createEmbedUrl,shortImage:this.createShortImageUrl,longImage:this.createLongImageUrl},this.imageQualities={0:"0",1:"1",2:"2",3:"3",DEFAULT:"default",HQDEFAULT:"hqdefault",SDDEFAULT:"sddefault",MQDEFAULT:"mqdefault",MAXRESDEFAULT:"maxresdefault"},this.defaultImageQuality=this.imageQualities.HQDEFAULT,this.mediaTypes={VIDEO:"video",PLAYLIST:"playlist",SHARE:"share"}}return l.prototype.parseUrl=function(t){var e=t.match(/(?:(?:v|vi|be|videos|embed)\/(?!videoseries)|(?:v|ci)=)([\w-]{11})/i);return e?e[1]:void 0},l.prototype.parseParameters=function(t,e){return(t.start||t.t)&&(t.start=p(t.start||t.t),delete t.t),t.v===e.id&&delete t.v,t.list===e.id&&delete t.list,t},l.prototype.parseMediaType=function(t){if(t.params.list&&(t.list=t.params.list,delete t.params.list),t.id&&!t.params.ci)t.mediaType=this.mediaTypes.VIDEO;else if(t.list)delete t.id,t.mediaType=this.mediaTypes.PLAYLIST;else{if(!t.params.ci)return;delete t.params.ci,t.mediaType=this.mediaTypes.SHARE}return t},l.prototype.parse=function(t,e){var r={params:e,id:this.parseUrl(t)};return r.params=this.parseParameters(e,r),r=this.parseMediaType(r)},l.prototype.createShortUrl=function(t,e){var r="https://youtu.be/"+t.id;return e.start&&(r+="#t="+e.start),r},l.prototype.createLongUrl=function(t,e){var r="",i=e.start;return delete e.start,t.mediaType===this.mediaTypes.PLAYLIST&&(e.feature="share",r+="https://youtube.com/playlist"),t.mediaType===this.mediaTypes.VIDEO&&(e.v=t.id,r+="https://youtube.com/watch"),t.mediaType===this.mediaTypes.SHARE&&(e.ci=t.id,r+="https://www.youtube.com/shared"),t.list&&(e.list=t.list),r+=n({params:e}),t.mediaType!==this.mediaTypes.PLAYLIST&&i&&(r+="#t="+i),r},l.prototype.createEmbedUrl=function(t,e){var r="//youtube.com/embed";return t.mediaType===this.mediaTypes.PLAYLIST?e.listType="playlist":(r+="/"+t.id,"1"===e.loop&&(e.playlist=t.id)),t.list&&(e.list=t.list),r+=n({params:e})},l.prototype.createImageUrl=function(t,e,r){return t+e.id+"/"+(r.imageQuality||this.defaultImageQuality)+".jpg"},l.prototype.createShortImageUrl=function(t,e){return this.createImageUrl("https://i.ytimg.com/vi/",t,e)},l.prototype.createLongImageUrl=function(t,e){return this.createImageUrl("https://img.youtube.com/vi/",t,e)},o.bind(new l),o});
