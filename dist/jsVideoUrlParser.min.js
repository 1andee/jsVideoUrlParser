!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.urlParser=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=function(e){if("object"!==t(e))return"";e.params=e.params||{};var r="",i=0,a=Object.keys(e.params);if(0===a.length)return"";for(a.sort(),e.hasParams||(r+="?"+a[0]+"="+e.params[a[0]],i+=1);i<a.length;i+=1)r+="&"+a[i]+"="+e.params[a[i]];return r},r=function(t){return void 0===t?0:t.match(/^(\d+[smhdw]?)+$/)?function(t){var e,r=0,i={s:1,m:60,h:3600,d:86400,w:604800};e=(t=t.replace(/([smhdw])/g," $1 ").trim()).split(" ");for(var a=0;a<e.length;a+=2)r+=parseInt(e[a],10)*i[e[a+1]||"s"];return r}(t):t.match(/^(\d+:?)+$/)?function(t){for(var e=0,r=[1,60,3600,86400,604800],i=t.split(":"),a=0;a<i.length;a++)e+=parseInt(i[a],10)*r[i.length-a-1];return e}(t):0},i=function(t){if("string"!=typeof t)return{};var e,r={},i=(t=t.split("+").join(" ")).match(/(?:[?](?:[^=]+)=(?:[^&#]*)(?:[&](?:[^=]+)=(?:[^&#]*))*(?:[#].*)?)|(?:[#].*)/);if(null===i)return{};e=i[0].substr(1).split(/[&#=]/);for(var a=0;a<e.length;a+=2)r[decodeURIComponent(e[a])]=decodeURIComponent(e[a+1]||"");return r};function a(){for(var t=["parseProvider","parse","bind","create"],e=0;e<t.length;e++){var r=t[e];this[r]=this[r].bind(this)}this.plugins={}}var s=a;a.prototype.parseProvider=function(t){var e=t.match(/(?:(?:https?:)?\/\/)?(?:[^.]+\.)?(\w+)\./i);return e?e[1]:void 0},a.prototype.parse=function(t){if(void 0!==t){var e,r=this.parseProvider(t),a=this.plugins[r];if(r&&a&&a.parse)return(e=a.parse.call(a,t,i(t)))&&((e=function(t){t.params&&0===Object.keys(t.params).length&&delete t.params;return t}(e)).provider=a.provider),e}},a.prototype.bind=function(t){if(this.plugins[t.provider]=t,t.alternatives)for(var e=0;e<t.alternatives.length;e+=1)this.plugins[t.alternatives[e]]=t},a.prototype.create=function(t){var e=t.videoInfo,r=t.params,i=this.plugins[e.provider];if(r="internal"===r?e.params:r||{},i&&(t.format=t.format||i.defaultFormat,i.formats.hasOwnProperty(t.format)))return i.formats[t.format].apply(i,[e,Object.assign({},r)])};var o=new s,n=e;function p(){this.provider="canalplus",this.defaultFormat="embed",this.formats={embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}p.prototype.parseParameters=function(t){return delete t.vid,t},p.prototype.parse=function(t,e){var r={mediaType:this.mediaTypes.VIDEO,id:e.vid};if(r.params=this.parseParameters(e),r.id)return r},p.prototype.createEmbedUrl=function(t,e){var r="http://player.canalplus.fr/embed/";return e.vid=t.id,r+=n({params:e})},o.bind(new p);var d=e;function m(){this.provider="coub",this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}m.prototype.parseUrl=function(t){var e=t.match(/(?:embed|view)\/([a-zA-Z\d]+)/i);return e?e[1]:void 0},m.prototype.parse=function(t,e){var r={mediaType:this.mediaTypes.VIDEO,params:e,id:this.parseUrl(t)};if(r.id)return r},m.prototype.createUrl=function(t,e,r){var i=t+e.id;return i+=d({params:r})},m.prototype.createLongUrl=function(t,e){return this.createUrl("https://coub.com/view/",t,e)},m.prototype.createEmbedUrl=function(t,e){return this.createUrl("//coub.com/embed/",t,e)},o.bind(new m);var l=e,c=r;function u(){this.provider="dailymotion",this.alternatives=["dai"],this.defaultFormat="long",this.formats={short:this.createShortUrl,long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}u.prototype.parseParameters=function(t){return this.parseTime(t)},u.prototype.parseTime=function(t){return t.start&&(t.start=c(t.start)),t},u.prototype.parseUrl=function(t){var e=t.match(/(?:\/video|ly)\/([A-Za-z0-9]+)/i);return e?e[1]:void 0},u.prototype.parse=function(t,e){var r={mediaType:this.mediaTypes.VIDEO,params:this.parseParameters(e),id:this.parseUrl(t)};return r.id?r:void 0},u.prototype.createUrl=function(t,e,r){return t+e.id+l({params:r})},u.prototype.createShortUrl=function(t){return this.createUrl("https://dai.ly/",t,{})},u.prototype.createLongUrl=function(t,e){return this.createUrl("https://dailymotion.com/video/",t,e)},u.prototype.createEmbedUrl=function(t,e){return this.createUrl("//www.dailymotion.com/embed/video/",t,e)},o.bind(new u);var h=e,y=r;function f(){this.provider="twitch",this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video",STREAM:"stream",CLIP:"clip"}}f.prototype.seperateId=function(t){return{pre:t[0],id:t.substr(1)}},f.prototype.parseChannel=function(t,e){var r=e.channel||e.utm_content||t.channel;return delete e.utm_content,delete e.channel,r},f.prototype.parseUrl=function(t,e,r){var i;return(i=t.match(/(clips\.)?twitch\.tv\/(?:(?:videos\/(\d+))|(\w+))?/i))&&i[2]?e.id="v"+i[2]:r.video?(e.id=r.video,delete r.video):r.clip?(e.id=r.clip,e.isClip=!0,delete r.clip):i&&i[1]&&i[3]?(e.id=i[3],e.isClip=!0):i&&i[3]&&(e.channel=i[3]),e},f.prototype.parseMediaType=function(t){var e;return t.channel?e=this.mediaTypes.STREAM:t.id&&(t.isClip?(e=this.mediaTypes.CLIP,delete t.isClip):e=this.mediaTypes.VIDEO,delete t.channel),e},f.prototype.parseParameters=function(t){return t.t&&(t.start=y(t.t),delete t.t),t},f.prototype.parse=function(t,e){var r={};return(r=this.parseUrl(t,r,e)).channel=this.parseChannel(r,e),r.mediaType=this.parseMediaType(r),r.params=this.parseParameters(e),r.channel||r.id?r:void 0},f.prototype.createLongUrl=function(t,e){var r="";(t.mediaType===this.mediaTypes.STREAM&&(r="https://twitch.tv/"+t.channel),t.mediaType===this.mediaTypes.VIDEO)&&(r="https://twitch.tv/videos/"+this.seperateId(t.id).id,e.start&&(e.t=e.start+"s",delete e.start));return t.mediaType===this.mediaTypes.CLIP&&(r="https://clips.twitch.tv/"+t.id),r+=h({params:e})},f.prototype.createEmbedUrl=function(t,e){var r="https://player.twitch.tv/";return t.mediaType===this.mediaTypes.STREAM&&(e.channel=t.channel),t.mediaType===this.mediaTypes.VIDEO&&(e.video=t.id,e.start&&(e.t=e.start+"s",delete e.start)),t.mediaType===this.mediaTypes.CLIP&&(r="https://clips.twitch.tv/embed",e.clip=t.id),r+=h({params:e})},o.bind(new f);var v=e,U=r;function T(){this.provider="vimeo",this.alternatives=["vimeopro"],this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}T.prototype.parseUrl=function(t){var e=t.match(/(?:\/(?:channels\/[\w]+|(?:(?:album\/\d+|groups\/[\w]+)\/)?videos?))?\/(\d+)/i);return e?e[1]:void 0},T.prototype.parseParameters=function(t){return this.parseTime(t)},T.prototype.parseTime=function(t){return t.t&&(t.start=U(t.t),delete t.t),t},T.prototype.parse=function(t,e){var r={mediaType:this.mediaTypes.VIDEO,params:this.parseParameters(e),id:this.parseUrl(t)};return r.id?r:void 0},T.prototype.createUrl=function(t,e,r){var i=t+e.id,a=r.start;return delete r.start,i+=v({params:r}),a&&(i+="#t="+a),i},T.prototype.createLongUrl=function(t,e){return this.createUrl("https://vimeo.com/",t,e)},T.prototype.createEmbedUrl=function(t,e){return this.createUrl("//player.vimeo.com/video/",t,e)},o.bind(new T);var b=e,g=r;function E(){this.provider="wistia",this.alternatives=[],this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl,embedjsonp:this.createEmbedJsonpUrl},this.mediaTypes={VIDEO:"video",EMBEDVIDEO:"embedvideo"}}E.prototype.parseUrl=function(t){var e=t.match(/(?:(?:medias|iframe)\/|wvideo=)([\w-]+)/);return e?e[1]:void 0},E.prototype.parseChannel=function(t){var e=t.match(/(?:(?:https?:)?\/\/)?([^.]*)\.wistia\./),r=e?e[1]:void 0;if("fast"!==r&&"content"!==r)return r},E.prototype.parseParameters=function(t,e){return t.wtime&&(t.start=g(t.wtime),delete t.wtime),t.wvideo===e.id&&delete t.wvideo,t},E.prototype.parseMediaType=function(t){return t.id&&t.channel?this.mediaTypes.VIDEO:t.id?(delete t.channel,this.mediaTypes.EMBEDVIDEO):void 0},E.prototype.parse=function(t,e){var r={id:this.parseUrl(t),channel:this.parseChannel(t)};if(r.params=this.parseParameters(e,r),r.mediaType=this.parseMediaType(r),r.id)return r},E.prototype.createUrl=function(t,e,r){return e.start&&(e.wtime=e.start,delete e.start),r+=b({params:e})},E.prototype.createLongUrl=function(t,e){if(t.mediaType!==this.mediaTypes.VIDEO)return"";var r="https://"+t.channel+".wistia.com/medias/"+t.id;return this.createUrl(t,e,r)},E.prototype.createEmbedUrl=function(t,e){var r="https://fast.wistia.com/embed/iframe/"+t.id;return this.createUrl(t,e,r)},E.prototype.createEmbedJsonpUrl=function(t){return"https://fast.wistia.com/embed/medias/"+t.id+".jsonp"},o.bind(new E);var I=e;function w(){this.provider="youku",this.defaultFormat="long",this.formats={embed:this.createEmbedUrl,long:this.createLongUrl,flash:this.createFlashUrl,static:this.createStaticUrl},this.mediaTypes={VIDEO:"video"}}w.prototype.parseUrl=function(t){var e=t.match(/(?:(?:embed|sid)\/|v_show\/id_|VideoIDS=)([a-zA-Z0-9]+)/);return e?e[1]:void 0},w.prototype.parseParameters=function(t){return t.VideoIDS&&delete t.VideoIDS,t},w.prototype.parse=function(t,e){var r={mediaType:this.mediaTypes.VIDEO,id:this.parseUrl(t),params:this.parseParameters(e)};if(r.id)return r},w.prototype.createUrl=function(t,e,r){var i=t+e.id;return i+=I({params:r})},w.prototype.createEmbedUrl=function(t,e){return this.createUrl("http://player.youku.com/embed/",t,e)},w.prototype.createLongUrl=function(t,e){return this.createUrl("http://v.youku.com/v_show/id_",t,e)},w.prototype.createStaticUrl=function(t,e){return this.createUrl("http://static.youku.com/v1.0.0638/v/swf/loader.swf?VideoIDS=",t,e)},w.prototype.createFlashUrl=function(t,e){var r="http://player.youku.com/player.php/sid/"+t.id+"/v.swf";return r+=I({params:e})},o.bind(new w);var L=e,D=r;function S(){this.provider="youtube",this.alternatives=["youtu","ytimg"],this.defaultFormat="long",this.formats={short:this.createShortUrl,long:this.createLongUrl,embed:this.createEmbedUrl,shortImage:this.createShortImageUrl,longImage:this.createLongImageUrl},this.imageQualities={0:"0",1:"1",2:"2",3:"3",DEFAULT:"default",HQDEFAULT:"hqdefault",SDDEFAULT:"sddefault",MQDEFAULT:"mqdefault",MAXRESDEFAULT:"maxresdefault"},this.defaultImageQuality=this.imageQualities.HQDEFAULT,this.mediaTypes={VIDEO:"video",PLAYLIST:"playlist",SHARE:"share"}}return S.prototype.parseUrl=function(t){var e=t.match(/(?:(?:v|vi|be|videos|embed)\/(?!videoseries)|(?:v|ci)=)([\w-]{11})/i);return e?e[1]:void 0},S.prototype.parseParameters=function(t,e){return(t.start||t.t)&&(t.start=D(t.start||t.t),delete t.t),t.v===e.id&&delete t.v,t.list===e.id&&delete t.list,t},S.prototype.parseMediaType=function(t){if(t.params.list&&(t.list=t.params.list,delete t.params.list),t.id&&!t.params.ci)t.mediaType=this.mediaTypes.VIDEO;else if(t.list)delete t.id,t.mediaType=this.mediaTypes.PLAYLIST;else{if(!t.params.ci)return;delete t.params.ci,t.mediaType=this.mediaTypes.SHARE}return t},S.prototype.parse=function(t,e){var r={params:e,id:this.parseUrl(t)};return r.params=this.parseParameters(e,r),r=this.parseMediaType(r)},S.prototype.createShortUrl=function(t,e){var r="https://youtu.be/"+t.id;return e.start&&(r+="#t="+e.start),r},S.prototype.createLongUrl=function(t,e){var r="",i=e.start;return delete e.start,t.mediaType===this.mediaTypes.PLAYLIST&&(e.feature="share",r+="https://youtube.com/playlist"),t.mediaType===this.mediaTypes.VIDEO&&(e.v=t.id,r+="https://youtube.com/watch"),t.mediaType===this.mediaTypes.SHARE&&(e.ci=t.id,r+="https://www.youtube.com/shared"),t.list&&(e.list=t.list),r+=L({params:e}),t.mediaType!==this.mediaTypes.PLAYLIST&&i&&(r+="#t="+i),r},S.prototype.createEmbedUrl=function(t,e){var r="//youtube.com/embed";return t.mediaType===this.mediaTypes.PLAYLIST?e.listType="playlist":(r+="/"+t.id,"1"===e.loop&&(e.playlist=t.id)),t.list&&(e.list=t.list),r+=L({params:e})},S.prototype.createImageUrl=function(t,e,r){return t+e.id+"/"+(r.imageQuality||this.defaultImageQuality)+".jpg"},S.prototype.createShortImageUrl=function(t,e){return this.createImageUrl("https://i.ytimg.com/vi/",t,e)},S.prototype.createLongImageUrl=function(t,e){return this.createImageUrl("https://img.youtube.com/vi/",t,e)},o.bind(new S),o});
